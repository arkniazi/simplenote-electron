(window.webpackJsonp=window.webpackJsonp||[]).push([[5,7],{1269:function(e,t,n){"use strict";n.r(t),n.d(t,"NoteEditor",(function(){return Ke}));var o=n(0),r=n.n(o),i=n(487),a=n(649);function c(){return r.a.createElement("svg",{className:"icon-chevron-right",xmlns:"http://www.w3.org/2000/svg",width:"24px",height:"24px",viewBox:"0 0 24 24"},r.a.createElement("rect",{x:"0",fill:"none",width:"24",height:"24"}),r.a.createElement("g",null,r.a.createElement("polygon",{points:"10.11 21.19 8.7 19.78 16.48 12 8.7 4.22 10.11 2.81 19.3 12 10.11 21.19"})))}var u=function(e){var t=e.selectedSearchMatchIndex,n=e.numberOfMatchesInNote,o=e.setSearchSelection;return r.a.createElement("div",{className:"search-results"},r.a.createElement("div",null,null===t?"".concat(n," Results"):"".concat(t+1," of ").concat(n)),r.a.createElement("span",{className:"search-results-next"},r.a.createElement(a.a,{disabled:n<=1,icon:r.a.createElement(c,null),onClick:function(e){o((n+(null!=t?t:-1)+1)%n)},title:"Next"})),r.a.createElement("span",{className:"search-results-prev"},r.a.createElement(a.a,{disabled:n<=1,icon:r.a.createElement(c,null),onClick:function(e){o((n+(null!=t?t:-1)-1)%n)},title:"Prev"})))};u.displayName="SearchResultsBar";var s=Object(i.b)((function(e){var t=e.ui;return{selectedSearchMatchIndex:t.selectedSearchMatchIndex,numberOfMatchesInNote:t.numberOfMatchesInNote}}),(function(e){return{setSearchSelection:function(t){return e({type:"STORE_SEARCH_SELECTION",index:t})}}}))(u),l=n(1176),d=n(33),f=n(610),p=n(515),h=Object(i.b)(null,(function(e){return{openShareDialog:function(){return e(Object(p.showDialog)("SHARE"))}}}))((function(e){var t=e.openShareDialog;return r.a.createElement("div",{className:"tag-email-tooltip"},r.a.createElement("div",{className:"tag-email-tooltip__arrow"}),r.a.createElement("div",{className:"tag-email-tooltip__inside"},"Collaboration has moved. Press the Share icon in the toolbar to access the ",r.a.createElement("a",{href:"#",onClick:t},"Collaborate screen"),"."))})),g=n(37),m=n.n(g),v=function(e){var t=e.onSelect,n=e.selected,o=e.tagName;return r.a.createElement("div",{className:m()("tag-chip",{selected:n}),"data-tag-name":o,onClick:t},o)};function y(e){return(y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function b(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return S(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return S(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,r=function(){};return{s:r,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,c=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){c=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(c)throw i}}}}function S(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function w(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function E(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function C(e,t){return(C=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function O(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=k(e);if(t){var r=k(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return T(this,n)}}function T(e,t){return!t||"object"!==y(t)&&"function"!=typeof t?N(e):t}function N(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function k(e){return(k=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function x(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var I=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&C(e,t)}(a,e);var t,n,o,i=O(a);function a(){for(var e,t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return w(this,a),x(N(e=i.call.apply(i,[this].concat(n))),"inputField",void 0),x(N(e),"inputObserver",void 0),x(N(e),"state",{isComposing:!1}),x(N(e),"completeSuggestion",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d.identity,n=e.props,o=n.onChange,r=n.note,i=n.tags,a=n.value;if(a.length){var c,u=null,s=b(i.values());try{for(s.s();!(c=s.n()).done;){var l=c.value;if(!r.tags.includes(l.name)&&l.name.startsWith(a)){u=l.name;break}}}catch(e){s.e(e)}finally{s.f()}u&&o(u,(function(){t(u),e.focusInput()}))}})),x(N(e),"focusInput",(function(){if(e.inputField){var t=e.inputField;t.focus();var n=document.createRange();n.selectNodeContents(t),n.collapse(!1);var o=window.getSelection();o.removeAllRanges(),o.addRange(n)}})),x(N(e),"hasFocus",(function(){return document.activeElement===e.inputField})),x(N(e),"interceptKeys",(function(t){var n;return Object(d.invoke)((x(n={},13,e.submitTag),x(n,188,e.submitTag),x(n,9,e.interceptTabPress),x(n,39,e.interceptRightArrow),n),t.keyCode,t)})),x(N(e),"interceptRightArrow",(function(t){var n=e.props.value;if(window.getSelection){var o=window.getSelection().getRangeAt(0),r=o.cloneRange();r.selectNodeContents(t.currentTarget),r.setEnd(o.endContainer,o.endOffset),r.toString().length===n.length&&(e.completeSuggestion(),t.preventDefault(),t.stopPropagation())}})),x(N(e),"interceptTabPress",(function(t){e.completeSuggestion(e.submitTag),t.preventDefault(),t.stopPropagation()})),x(N(e),"onInputMutation",(function(t){t.forEach((function(t){var n=Object(d.get)(t,"target.data","");"childList"===t.type&&t.addedNodes.length&&(n=Object(d.get)(t,"target.innerText","")),e.onInput(n)}))})),x(N(e),"onInput",(function(t){e.state.isComposing||e.props.onChange(t.trim(),e.focusInput)})),x(N(e),"onCompositionEnd",(function(t){var n=t.target.textContent;e.setState({isComposing:!1},(function(){return e.onInput(n)}))})),x(N(e),"removePastedFormatting",(function(t){var n;Object(d.get)(t,"clipboardData.getData")?n=t.clipboardData.getData("text/plain"):Object(d.get)(window,"clipboardData.getData")&&(n=window.clipboardData.getData("Text")),e.onInput(n),t.preventDefault(),t.stopPropagation()})),x(N(e),"storeInput",(function(t){e.inputField=t,e.props.inputRef(t),Object(d.invoke)(N(e),"inputField.addEventListener","paste",e.removePastedFormatting,!1)})),x(N(e),"submitTag",(function(t){var n=e.props,o=n.onSelect,r=n.value;r.trim().length&&o(r.trim()),Object(d.invoke)(t,"preventDefault"),Object(d.invoke)(t,"stopPropagation")})),e}return t=a,(n=[{key:"componentDidMount",value:function(){this.props.storeFocusInput(this.focusInput),this.props.storeHasFocus(this.hasFocus),this.inputObserver=new MutationObserver(this.onInputMutation),this.inputObserver.observe(this.inputField,{characterData:!0,childList:!0,subtree:!0})}},{key:"componentWillUnmount",value:function(){Object(d.invoke)(this,"inputField.removeEventListener","paste",this.removePastedFormatting,!1),this.inputObserver.disconnect()}},{key:"render",value:function(){var e=this,t=this.props,n=t.note,o=t.tags,i=t.value,a=null;if(i.length>0){var c,u=b(o.values());try{for(u.s();!(c=u.n()).done;){var s=c.value;if(!n.tags.includes(s.name)&&s.name.startsWith(i)){a=s.name;break}}}catch(e){u.e(e)}finally{u.f()}}var l=""===i&&!this.state.isComposing;return r.a.createElement("div",{className:"tag-input",onClick:this.focusInput},l&&r.a.createElement("span",{"aria-hidden":!0,className:"tag-input__placeholder"},"Add a tag…"),r.a.createElement("div",{"aria-label":"Add a tag…",ref:this.storeInput,className:"tag-input__entry",contentEditable:"true",onCompositionStart:function(){return e.setState({isComposing:!0})},onCompositionEnd:this.onCompositionEnd,onKeyDown:this.interceptKeys,spellCheck:!1,suppressContentEditableWarning:!0},i),r.a.createElement("div",{className:"tag-input__suggestion",disabled:!0,type:"text"},a?a.substring(i.length):""))}}])&&E(t.prototype,n),o&&E(t,o),a}(o.Component);x(I,"displayName","TagInput"),x(I,"defaultProps",{inputRef:d.identity,onChange:d.identity,onSelect:d.identity,storeFocusInput:d.noop,storeHasFocus:d.noop});var F=Object(i.b)((function(e){return{note:e.data.notes.get(e.ui.openedNote),tags:e.data.tags}}))(I),M=n(573);function j(e){return(j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function L(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function R(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function A(e,t){return(A=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function D(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=K(e);if(t){var r=K(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return P(this,n)}}function P(e,t){return!t||"object"!==j(t)&&"function"!=typeof t?_(e):t}function _(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function K(e){return(K=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function H(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var W=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&A(e,t)}(c,e);var t,n,i,a=D(c);function c(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return L(this,c),H(_(e=a.call.apply(a,[this].concat(n))),"container",Object(o.createRef)()),H(_(e),"focusInput",void 0),H(_(e),"hiddenTag",void 0),H(_(e),"inputHasFocus",void 0),H(_(e),"tagInput",Object(o.createRef)()),H(_(e),"state",{selectedTag:"",showEmailTooltip:!1,tagInput:""}),H(_(e),"addTag",(function(t){var n=e.props,o=n.note,r=n.noteId,i=t.trim().replace(/\s+/g,",").split(",");i.some(f.a)&&e.showEmailTooltip();var a=new Set(o.tags.map(M.a));i.forEach((function(t){a.has(Object(M.a)(t))||(a.add(Object(M.a)(t)),e.props.addTag(r,t))})),e.storeTagInput(""),Object(d.invoke)(_(e),"tagInput.focus")})),H(_(e),"hasSelection",(function(){return e.state.selectedTag&&!!e.state.selectedTag.length})),H(_(e),"deleteTag",(function(t){var n=e.props.noteId,o=e.state.selectedTag;e.props.removeTag(n,t),o===t&&e.setState({selectedTag:""},(function(){var t,n;return null===(t=e.tagInput)||void 0===t||null===(n=t.current)||void 0===n?void 0:n.focus()}))})),H(_(e),"deleteSelection",(function(){e.hasSelection()&&e.deleteTag(e.state.selectedTag)})),H(_(e),"hideEmailTooltip",(function(){return e.setState({showEmailTooltip:!1})})),H(_(e),"hasFocus",(function(){return!!e.inputHasFocus&&e.inputHasFocus()})),H(_(e),"focusTagField",(function(){return e.focusInput&&e.focusInput()})),H(_(e),"interceptKeys",(function(t){if(8===t.which){if(e.hasSelection()&&e.deleteSelection(),""!==e.state.tagInput)return;return e.selectLastTag(),void t.preventDefault()}if(39===t.which&&e.hasSelection())return e.unselect(t),void e.focusTagField();9===t.which&&e.hasSelection()&&e.unselect(t)})),H(_(e),"preventStealingFocus",(function(t){var n=t.ctrlKey,o=t.key,r=t.metaKey,i=t.shiftKey;if(e.props.keyboardShortcuts)return(n||r)&&i&&"y"===o.toLowerCase()&&e.setState({selectedTag:""}),!0})),H(_(e),"selectLastTag",(function(){var t;return e.setState({selectedTag:null===(t=e.props.note)||void 0===t?void 0:t.tags.slice(-1).shift()})})),H(_(e),"selectTag",(function(t){var n=t.currentTarget.dataset.tagName;t.preventDefault(),t.stopPropagation(),e.deleteTag(n)})),H(_(e),"showEmailTooltip",(function(){e.setState({showEmailTooltip:!0}),setTimeout((function(){return e.setState({showEmailTooltip:!1})}),5e3)})),H(_(e),"onKeyDown",(function(t){return e.state.showEmailTooltip&&e.hideEmailTooltip(),e.interceptKeys(t)})),H(_(e),"storeFocusInput",(function(t){return e.focusInput=t})),H(_(e),"storeHasFocus",(function(t){return e.inputHasFocus=t})),H(_(e),"storeHiddenTag",(function(t){return e.hiddenTag=t})),H(_(e),"storeInputRef",(function(t){return e.tagInput=t})),H(_(e),"storeTagInput",(function(t,n){return e.setState({tagInput:t},n)})),H(_(e),"unselect",(function(t){var n;e.state.selectedTag&&(null===(n=e.hiddenTag)||void 0===n?void 0:n.current)!==t.relatedTarget&&e.setState({selectedTag:""})})),H(_(e),"getTagName",(function(t){var n;return null===(n=e.props.allTags.get(Object(M.a)(t)))||void 0===n?void 0:n.name})),e}return t=c,(n=[{key:"componentDidMount",value:function(){this.props.storeFocusTagField(this.focusTagField),this.props.storeHasFocus(this.hasFocus),document.addEventListener("click",this.unselect,!0),window.addEventListener("keydown",this.preventStealingFocus,!0)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("click",this.unselect,!0),window.removeEventListener("keydown",this.preventStealingFocus,!0)}},{key:"componentDidUpdate",value:function(){var e,t;this.hasSelection()&&(null===(e=this.hiddenTag)||void 0===e||null===(t=e.current)||void 0===t||t.focus())}},{key:"render",value:function(){var e=this,t=this.props.note,n=this.state,o=n.selectedTag,i=n.showEmailTooltip,a=n.tagInput;return r.a.createElement("div",{ref:this.container,className:"tag-field"},r.a.createElement("div",{className:m()("tag-editor",{"has-selection":this.hasSelection()}),tabIndex:-1,onKeyDown:this.onKeyDown},r.a.createElement("input",{className:"hidden-tag",tabIndex:-1,ref:this.storeHiddenTag}),null==t?void 0:t.tags.filter(Object(d.negate)(f.a)).map((function(t){return r.a.createElement(v,{key:t,tagName:e.getTagName(t),selected:t===o,onSelect:e.selectTag})})),r.a.createElement(F,{inputRef:this.storeInputRef,value:a,onChange:this.storeTagInput,onSelect:this.addTag,storeFocusInput:this.storeFocusInput,storeHasFocus:this.storeHasFocus}),r.a.createElement(l.a,{container:this.container.current,onHide:this.hideEmailTooltip,placement:"top",rootClose:!0,shouldUpdatePosition:!0,show:i,target:this.tagInput.current},(function(){return r.a.createElement(h,null)}))))}}])&&R(t.prototype,n),i&&R(t,i),c}(o.Component);H(W,"displayName","TagField");var B=Object(i.b)((function(e){return{allTags:e.data.tags,keyboardShortcuts:e.settings.keyboardShortcuts,noteId:e.ui.openedNote,note:e.data.notes.get(e.ui.openedNote)}}),{addTag:function(e,t){return{type:"ADD_NOTE_TAG",noteId:e,tagName:t}},removeTag:function(e,t){return{type:"REMOVE_NOTE_TAG",noteId:e,tagName:t}}})(W),U=n(895),Q=n(946),G=n(728),Y=n(500),$=n(538),V=n(549),q=n(572),z=n(77),J=n(590);function X(e){return(X="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Z(e){return function(e){if(Array.isArray(e))return re(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||oe(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ee(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function te(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ee(Object(n),!0).forEach((function(t){fe(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ee(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ne(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],o=!0,r=!1,i=void 0;try{for(var a,c=e[Symbol.iterator]();!(o=(a=c.next()).done)&&(n.push(a.value),!t||n.length!==t);o=!0);}catch(e){r=!0,i=e}finally{try{o||null==c.return||c.return()}finally{if(r)throw i}}return n}(e,t)||oe(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function oe(e,t){if(e){if("string"==typeof e)return re(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?re(e,t):void 0}}function re(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function ie(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ae(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function ce(e,t){return(ce=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ue(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=de(e);if(t){var r=de(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return se(this,n)}}function se(e,t){return!t||"object"!==X(t)&&"function"!=typeof t?le(e):t}function le(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function de(e){return(de=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function fe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var pe=function(e){return{range:new monaco.Range(e,1,e,1),options:{isWholeLine:!0,inlineClassName:"note-title",stickiness:Q.editor.TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges}}},he=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ce(e,t)}(c,e);var t,n,i,a=ue(c);function c(){var e;ie(this,c);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return fe(le(e=a.call.apply(a,[this].concat(n))),"bootTimer",null),fe(le(e),"editor",null),fe(le(e),"monaco",null),fe(le(e),"contentDiv",Object(o.createRef)()),fe(le(e),"decorations",[]),fe(le(e),"matchesInNote",[]),fe(le(e),"state",{content:"",editor:"fast",noteId:null,overTodo:!1,searchQuery:""}),fe(le(e),"toggleShortcuts",(function(t){t?window.addEventListener("keydown",e.handleShortcut,!0):window.removeEventListener("keydown",e.handleShortcut,!0)})),fe(le(e),"completionProvider",(function(e,t){return{triggerCharacters:["["],provideCompletionItems:function(t,n,o,r){var i=t.getLineContent(n.lineNumber),a=i.lastIndexOf("[",n.column),c=i.lastIndexOf("]",n.column),u=a>=0&&c<a?a:-1,s=u>=0?i.slice(u+1,n.column):"",l=Object(G.b)({searchTerms:Object(V.a)(s),excludeIDs:e?[e]:[],openedTag:null,showTrash:!1,searchTags:Object(G.c)(s),titleOnly:!0},5).map((function(e){var t=ne(e,2),n=t[0],o=t[1];return te({noteId:n,content:o.content,isPinned:o.systemTags.includes("pinned")},Object(q.c)(o))})),d=u>=0?[{text:"",range:{startLineNumber:n.lineNumber,startColumn:u,endLineNumber:n.lineNumber,endColumn:n.column}}]:[];return{incomplete:!0,suggestions:l.map((function(e,t){return{additionalTextEdits:d,kind:e.isPinned?Q.languages.CompletionItemKind.Snippet:Q.languages.CompletionItemKind.File,label:e.title,documentation:e.content,insertText:"[".concat(e.title,"](simplenote://note/").concat(e.noteId,")"),sortText:t.toString(),range:{startLineNumber:n.lineNumber,startColumn:n.column,endLineNumber:n.lineNumber,endColumn:n.column}}}))}}}})),fe(le(e),"handleShortcut",(function(t){var n=t.ctrlKey,o=t.metaKey,r=t.shiftKey,i=t.key.toLowerCase(),a=n||o;return a&&r&&"g"===i?(e.setPrevSearchSelection(),t.stopPropagation(),t.preventDefault(),!1):window.electron||!a||r||"g"!==i?void 0:(e.setNextSearchSelection(),t.stopPropagation(),t.preventDefault(),!1)})),fe(le(e),"setDecorators",(function(){var t,n;e.matchesInNote=null!==(t=e.searchMatches())&&void 0!==t?t:[],e.props.storeNumberOfMatchesInNote(e.matchesInNote.length);var o=null!==(n=e.getTitleDecoration())&&void 0!==n?n:[];e.decorations=e.editor.deltaDecorations(e.decorations,[].concat(Z(e.matchesInNote),Z(o)))})),fe(le(e),"getTitleDecoration",(function(){var t=e.editor.getModel();if(t)for(var n=1;n<=t.getLineCount();n++){if(t.getLineContent(n).trim().length>0)return[pe(n)]}})),fe(le(e),"searchMatches",(function(){if(e.editor&&e.props.searchQuery){var t=e.editor.getModel(),n=Object(V.a)(e.props.searchQuery).map((function(e){return e.normalize().toLowerCase()})).filter((function(e){return e.trim().length>0}));if(0===n.length)return[];var o=t.getValue().normalize().toLowerCase();return n.reduce((function(e,n){for(var r=null,i=0;-1!==r&&-1!==(r=o.indexOf(n,i));){i=r+n.length;var a=t.getPositionAt(r),c=t.getPositionAt(r+n.length);e.push({options:{inlineClassName:"search-decoration",overviewRuler:{color:"#3361cc",position:Q.editor.OverviewRulerLane.Full}},range:{startLineNumber:a.lineNumber,startColumn:a.column,endLineNumber:c.lineNumber,endColumn:c.column}})}return e}),[])}})),fe(le(e),"focusEditor",(function(){var t;return null===(t=e.editor)||void 0===t?void 0:t.focus()})),fe(le(e),"hasFocus",(function(){var t;return null===(t=e.editor)||void 0===t?void 0:t.hasTextFocus()})),fe(le(e),"handleUndoRedo",(function(t){var n,o;switch(t.inputType){case"historyUndo":return null===(n=e.editor)||void 0===n||n.trigger("browserMenu","undo",null),t.preventDefault(),void t.stopPropagation();case"historyRedo":return null===(o=e.editor)||void 0===o||o.trigger("browserMenu","redo",null),t.preventDefault(),void t.stopPropagation()}})),fe(le(e),"cancelSelectionOrSearch",(function(t){e.props.searchQuery.length>0&&e.matchesInNote.length>0?e.props.clearSearch():t.trigger("customAction","cancelSelection",null)})),fe(le(e),"insertOrRemoveCheckboxes",(function(t){var n=t.getSelection();if(n)for(var o=n.startLineNumber;o<=n.endLineNumber;o++)e.toggleChecklistForLine(t,o);else{var r=t.getPosition();if(!r)return;e.toggleChecklistForLine(t,r.lineNumber)}})),fe(le(e),"toggleChecklistForLine",(function(t,n){var o,r,i=t.getModel();if(i){var a=i.getLineContent(n),c=/^(\s*)([-+*\u2022]\s*)?([\ue000\ue001]\s+)?/.exec(a);if(c){var u=ne(c,4),s=(u[0],u[1]),l=u[2],d=u[3],f=void 0!==d,p=s.length+(null!==(o=null==l?void 0:l.length)&&void 0!==o?o:0)+1,h=f?"":" ",g={identifier:{major:1,minor:1},range:new e.monaco.Range(n,p,n,p+(null!==(r=null==d?void 0:d.length)&&void 0!==r?r:0)),text:h,forceMoveMarkers:!0};t.executeEdits("insertOrRemoveCheckboxes",[g]),e.props.insertTask()}}})),fe(le(e),"editorInit",(function(e){Q.editor.defineTheme("simplenote",{base:"vs",inherit:!0,rules:[{background:"FFFFFF"}],colors:{"editor.foreground":"#2c3338","editor.background":"#ffffff","editor.selectionBackground":"#ced9f2","scrollbarSlider.activeBackground":"#8c8f94","scrollbarSlider.background":"#c3c4c7","scrollbarSlider.hoverBackground":"#a7aaad","textLink.foreground":"#1d4fc4"}}),Q.editor.defineTheme("simplenote-dark",{base:"vs-dark",inherit:!0,rules:[{background:"1d2327"}],colors:{"editor.foreground":"#ffffff","editor.background":"#1d2327","editor.selectionBackground":"#50575e","scrollbarSlider.activeBackground":"#646970","scrollbarSlider.background":"#2c3338","scrollbarSlider.hoverBackground":"#1d2327","textLink.foreground":"#ced9f2"}})})),fe(le(e),"editorReady",(function(t,n){var o,r,i;e.editor=t,e.monaco=n,n.languages.registerLinkProvider("plaintext",{provideLinks:function(e){return{links:e.findMatches("simplenote://note/[a-zA-Z0-9-]+",!0,!0,!1,null,!1).map((function(e){return{range:e.range}}))}},resolveLink:function(n){var o,r,i=null!==(o=null===(r=t.getModel())||void 0===r?void 0:r.getValueInRange(n.range))&&void 0!==o?o:"",a=/^simplenote:\/\/note\/(.+)$/.exec(i);if(a){var c=ne(a,2),u=(c[0],c[1]);return e.props.notes.has(u)&&e.props.openNote(u),te(te({},n),{},{url:"#"})}}});var a=["cancelSelection","cursorUndo","editor.action.commentLine","editor.action.jumpToBracket","editor.action.transposeLetters","expandLineSelection","editor.action.gotoLine","editor.action.insertCursorAbove","editor.action.insertCursorBelow","editor.action.insertCursorAtEndOfEachLineSelected","actions.find","actions.findWithSelection","editor.action.addSelectionToNextFindMatch","editor.action.nextMatchFindAction","editor.action.selectHighlights"];window.electron&&z.b&&a.push("undo","redo","editor.action.selectAll"),a.forEach((function(e){t._standaloneKeybindingService.addDynamicKeybinding("-"+e,void 0,(function(){}))})),t.createContextKey("allowBrowserKeybinding",!window.electron),t.addAction({id:"context_undo",label:"Undo",keybindings:[n.KeyMod.CtrlCmd|n.KeyCode.KEY_Z],keybindingContext:"allowBrowserKeybinding",contextMenuGroupId:"1_modification",contextMenuOrder:2,run:function(){t.trigger("contextMenu","undo",null)}}),t.addAction({id:"context_redo",label:"Redo",keybindings:[n.KeyMod.WinCtrl|n.KeyCode.KEY_Y,n.KeyMod.CtrlCmd|n.KeyMod.Shift|n.KeyCode.KEY_Z],keybindingContext:"allowBrowserKeybinding",contextMenuGroupId:"1_modification",contextMenuOrder:3,run:function(){t.trigger("contextMenu","redo",null)}}),t.addAction({id:"context_cut",label:"Cut",keybindings:[n.KeyMod.CtrlCmd|n.KeyCode.KEY_X],keybindingContext:"allowBrowserKeybinding",contextMenuGroupId:"9_cutcopypaste",contextMenuOrder:1,run:function(){t.trigger("contextMenu","editor.action.clipboardCutAction",null)}}),t.addAction({id:"context_copy",label:"Copy",keybindings:[n.KeyMod.CtrlCmd|n.KeyCode.KEY_C],keybindingContext:"allowBrowserKeybinding",contextMenuGroupId:"9_cutcopypaste",contextMenuOrder:2,run:function(){t.trigger("contextMenu","editor.action.clipboardCopyAction",null)}}),t.addAction({id:"cancel_selection",label:"Cancel Selection",keybindings:[n.KeyCode.Escape],keybindingContext:"!suggestWidgetVisible",run:e.cancelSelectionOrSearch}),window.electron&&t.addAction({id:"paste",label:"Paste",contextMenuGroupId:"9_cutcopypaste",contextMenuOrder:3,keybindings:[n.KeyMod.CtrlCmd|n.KeyCode.KEY_V],keybindingContext:"allowBrowserKeybinding",run:function(){document.execCommand("paste")}}),t.addAction({id:"select_all",label:"Select All",contextMenuGroupId:"9_cutcopypaste",contextMenuOrder:4,keybindings:[n.KeyMod.CtrlCmd|n.KeyCode.KEY_A],keybindingContext:"allowBrowserKeybinding",run:function(){t.setSelection(t.getModel().getFullModelRange())}}),t.addAction({id:"insertChecklist",label:"Insert Checklist",keybindings:[n.KeyMod.CtrlCmd|n.KeyMod.Shift|n.KeyCode.KEY_C],keybindingContext:"allowBrowserKeybinding",contextMenuGroupId:"10_checklist",contextMenuOrder:1,run:e.insertOrRemoveCheckboxes}),t.addAction({id:"selectUpWithoutMulticursor",label:"Select Up",keybindings:[n.KeyMod.CtrlCmd|n.KeyMod.Shift|n.KeyCode.UpArrow],run:function(){t.trigger("shortcuts","cursorUpSelect",null)}}),t.addAction({id:"selectDownWithoutMulticursor",label:"Select Down",keybindings:[n.KeyMod.CtrlCmd|n.KeyMod.Shift|n.KeyCode.DownArrow],run:function(){t.trigger("shortcuts","cursorDownSelect",null)}}),t.addCommand(n.KeyCode.Tab,(function(){var e,n,o=null===(e=t.getPosition())||void 0===e?void 0:e.lineNumber;if(o){var r=null===(n=t.getModel())||void 0===n?void 0:n.getLineContent(o);r&&/^(\s*)([-+*\u2022\ue000\ue001])(\s+)/.test(r)?t.trigger("commands","editor.action.indentLines",null):t.trigger("commands","tab",null)}})),null===(o=window.electron)||void 0===o||o.receive("editorCommand",(function(n){switch(n.action){case"findAgain":return void e.setNextSearchSelection();case"insertChecklist":return void t.trigger("editorCommand","insertChecklist",null);case"redo":return void(t.hasTextFocus()?t.trigger("editorCommand","redo",null):document.execCommand("redo"));case"selectAll":return void(t.hasTextFocus()?t.setSelection(t.getModel().getFullModelRange()):document.execCommand("selectAll"));case"undo":return void(t.hasTextFocus()?t.trigger("editorCommand","undo",null):document.execCommand("undo"))}})),window.electron||window.addEventListener("input",e.handleUndoRedo,!0),e.setDecorators(),e.setState({}),t.onDidChangeModelContent((function(){return e.setDecorators()}));var c=n.languages.registerCompletionItemProvider("plaintext",e.completionProvider(e.state.noteId,t));t.onDidDispose((function(){return null==c?void 0:c.dispose()})),n.languages.setLanguageConfiguration("plaintext",{wordPattern:/[^\s]+/g}),document.oncopy=function(e){e.clipboardData.setData("text/plain",Object(J.b)(e.clipboardData.getData("text/plain")))};var u=ne(e.props.editorSelection,3),s=u[0],l=u[1],d=u[2],f=null===(r=e.editor.getModel())||void 0===r?void 0:r.getPositionAt(s),p=null===(i=e.editor.getModel())||void 0===i?void 0:i.getPositionAt(l);e.editor.setSelection(Q.Selection.createWithDirection(null==f?void 0:f.lineNumber,null==f?void 0:f.column,null==p?void 0:p.lineNumber,null==p?void 0:p.column,"RTL"===d?Q.SelectionDirection.RTL:Q.SelectionDirection.LTR)),t.revealLine(f.lineNumber,Q.editor.ScrollType.Immediate),t.onDidChangeCursorSelection((function(n){var o,r;if(n.reason!==Q.editor.CursorChangeReason.Undo&&n.reason!==Q.editor.CursorChangeReason.Redo){var i=null===(o=t.getModel())||void 0===o?void 0:o.getOffsetAt(n.selection.getStartPosition()),a=null===(r=t.getModel())||void 0===r?void 0:r.getOffsetAt(n.selection.getEndPosition()),c=n.selection.getDirection()===Q.SelectionDirection.LTR?"LTR":"RTL";e.props.storeEditorSelection(e.props.noteId,i,a,c)}})),t.onMouseMove((function(n){var o=e.state.content,r=n.target.range;if(r&&!(r.endColumn-r.startColumn>1)){var i=t.getModel();if(i){var a=i.getOffsetAt({lineNumber:r.startLineNumber,column:r.startColumn}),c=""===o[a]||""===o[a];e.state.overTodo!==c&&e.setState({overTodo:c})}}})),t.onMouseDown((function(n){var o=e.props,r=o.editNote,i=o.noteId,a=e.state.content,c=n.target.range;if(c&&!(c.endColumn-c.startColumn>1)){var u=t.getModel();if(u){var s=u.getOffsetAt({lineNumber:c.startLineNumber,column:c.startColumn});""===a[s]?r(i,{content:Object(J.b)(a.slice(0,s)+""+a.slice(s+1))}):""===a[s]&&r(i,{content:Object(J.b)(a.slice(0,s)+""+a.slice(s+1))})}}}))})),fe(le(e),"updateNote",(function(t,n){var o=e.props,r=o.editNote,i=o.noteId;if(e.editor){var a=function(){if(e.editor&&!n.isRedoing&&!n.isUndoing){var o=n.changes.find((function(e){var t=e.text;return("\r"===t[0]||"\n"===t[0])&&""===t.trim()}));if(o){var r=o.range.startLineNumber;if(0!==r&&r===o.range.endLineNumber){var i=e.editor.getModel(),a=i.getLineContent(r),c=/^(\s*)([-+*\u2022\ue000\ue001])(\s+)/.exec(a);if(null!==c){var u=i.getLineContent(r+1);if(/^\s*$/.test(u)){if(!(0===u.trim().length&&a.length===c[0].length)){var s=i.getOffsetAt({column:0,lineNumber:r+1}),l=i.getOffsetAt({column:0,lineNumber:r+2}),d={identifier:{major:1,minor:1},range:new e.monaco.Range(r+1,0,r+1,u.length),text:c[0].replace("",""),forceMoveMarkers:!0};return e.editor.executeEdits("autolist",[d]),Promise.resolve().then((function(){return e.editor.setPosition({column:c[0].length+1,lineNumber:r+1})})),t.slice(0,s)+c[0].replace("","")+n.eol+t.slice(l)}i.getOffsetAt({column:0,lineNumber:r}),i.getOffsetAt({column:0,lineNumber:r+1});var f={identifier:{major:1,minor:1},range:new e.monaco.Range(r,0,r+1,u.length+1),text:null,forceMoveMarkers:!0};Promise.resolve().then((function(){e.editor.executeEdits("autolist",[f]),e.editor.setPosition({column:0,lineNumber:r})}))}}}}}}()||t;r(i,{content:Object(J.b)(a)})}})),fe(le(e),"setNextSearchSelection",(function(){var t=e.props.selectedSearchMatchIndex,n=e.matchesInNote.length,o=(n+(null!=t?t:-1)+1)%n;e.props.storeSearchSelection(o),e.setSearchSelection(o)})),fe(le(e),"setPrevSearchSelection",(function(){var t=e.props.selectedSearchMatchIndex,n=e.matchesInNote.length,o=(n+(null!=t?t:n)-1)%n;e.props.storeSearchSelection(o),e.setSearchSelection(o)})),fe(le(e),"setSearchSelection",(function(t){if(e.matchesInNote.length){var n=e.matchesInNote[t].range;e.editor.setSelection(n),e.editor.revealLineInCenter(n.startLineNumber),e.focusEditor()}})),e}return t=c,i=[{key:"getDerivedStateFromProps",value:function(e,t){var n=e.note.content.length>5e3,o=e.note.content!==t.content,r=e.noteId!==t.noteId,i=o?r&&n?e.note.content.slice(0,e.editorSelection[1]+5e3):Object(J.a)(e.note.content):t.content,a=r?n?"fast":"full":t.editor,c=e.searchQuery!==t.searchQuery;return(r||c)&&e.storeSearchSelection(0),{content:i,editor:a,noteId:e.noteId,searchQuery:e.searchQuery}}}],(n=[{key:"componentDidMount",value:function(){var e=this,t=this.props.noteId;this.bootTimer=setTimeout((function(){t===e.props.noteId&&e.setState({editor:"full",content:Object(J.a)(e.props.note.content)})}),120),this.focusEditor(),this.props.storeFocusEditor(this.focusEditor),this.props.storeHasFocus(this.hasFocus),this.toggleShortcuts(!0)}},{key:"componentWillUnmount",value:function(){var e;this.bootTimer&&clearTimeout(this.bootTimer),null===(e=window.electron)||void 0===e||e.removeListener("editorCommand"),window.removeEventListener("input",this.handleUndoRedo,!0),this.toggleShortcuts(!1)}},{key:"componentDidUpdate",value:function(e){var t,n,o=this,r=ne(e.editorSelection,3),i=r[0],a=r[1],c=r[2],u=ne(this.props.editorSelection,3),s=u[0],l=u[1],d=u[2];if(this.editor&&"full"===this.state.editor&&(i!==s||a!==l||c!==d)){var f,p,h=null===(f=this.editor.getModel())||void 0===f?void 0:f.getPositionAt(s),g=null===(p=this.editor.getModel())||void 0===p?void 0:p.getPositionAt(l);this.editor.setSelection(Q.Selection.createWithDirection(null==h?void 0:h.lineNumber,null==h?void 0:h.column,null==g?void 0:g.lineNumber,null==g?void 0:g.column,"RTL"===d?Q.SelectionDirection.RTL:Q.SelectionDirection.LTR))}""===this.props.searchQuery&&""!==e.searchQuery&&(null===(t=this.editor)||void 0===t||t.setSelection(new this.monaco.Range(0,0,0,0))),this.props.lineLength===e.lineLength&&this.props.isFocusMode===e.isFocusMode||setTimeout((function(){o.editor&&o.editor.layout()}),400),this.editor&&"full"===this.state.editor&&e.searchQuery!==this.props.searchQuery&&(null===(n=this.editor)||void 0===n||n.layout(),this.setDecorators()),this.editor&&"full"===this.state.editor&&e.selectedSearchMatchIndex!==this.props.selectedSearchMatchIndex&&this.setSearchSelection(this.props.selectedSearchMatchIndex)}},{key:"render",value:function(){var e,t=this.props,n=t.lineLength,o=t.noteId,i=t.searchQuery,a=t.theme,c=this.state,u=c.content,s=c.editor,l=c.overTodo,d=(i&&this.searchMatches(),function(e,t){return"full"===e||void 0===t?25:t<=1072?.1*t:(t-768)/2}(n,null===(e=this.contentDiv.current)||void 0===e?void 0:e.offsetWidth));return r.a.createElement("div",{ref:this.contentDiv,className:"note-content-editor-shell".concat(l?" cursor-pointer":""),onClick:this.focusEditor},r.a.createElement("div",{className:"note-content-plaintext".concat("fast"===s?" visible":"")},u),"fast"!==s&&r.a.createElement(U.default,{key:o,editorDidMount:this.editorReady,editorWillMount:this.editorInit,language:"plaintext",theme:"dark"===a?"simplenote-dark":"simplenote",onChange:this.updateNote,options:{autoClosingBrackets:"never",autoClosingQuotes:"never",autoIndent:"keep",autoSurround:"never",automaticLayout:!0,codeLens:!1,folding:!1,fontFamily:'"Simplenote Tasks", -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", "Oxygen-Sans", "Ubuntu", "Cantarell", "Helvetica Neue", sans-serif',hideCursorInOverviewRuler:!0,lineDecorationsWidth:d,fontSize:16,lineHeight:24,lineNumbers:"off",links:!0,matchBrackets:"never",minimap:{enabled:!1},occurrencesHighlight:!1,overviewRulerBorder:!1,quickSuggestions:!1,renderIndentGuides:!1,renderLineHighlight:"none",scrollbar:{horizontal:"hidden",useShadows:!1,verticalScrollbarSize:d},scrollBeyondLastLine:!1,selectionHighlight:!1,suggestOnTriggerCharacters:!0,wordWrap:"bounded",wrappingStrategy:z.c?"simple":"advanced",wordWrapColumn:400},value:u}))}}])&&ae(t.prototype,n),i&&ae(t,i),c}(o.Component),ge={clearSearch:function(){return Y.a.ui.search("")},editNote:Y.a.data.editNote,insertTask:function(){return{type:"INSERT_TASK"}},openNote:Y.a.ui.selectNote,storeEditorSelection:function(e,t,n,o){return{type:"STORE_EDITOR_SELECTION",noteId:e,start:t,end:n,direction:o}},storeNumberOfMatchesInNote:function(e){return{type:"STORE_NUMBER_OF_MATCHES_IN_NOTE",matches:e}},storeSearchSelection:function(e){return{type:"STORE_SEARCH_SELECTION",index:e}}},me=Object(i.b)((function(e){var t;return{editorSelection:null!==(t=e.ui.editorSelection.get(e.ui.openedNote))&&void 0!==t?t:[0,0,"LTR"],isFocusMode:e.settings.focusModeEnabled,keyboardShortcuts:e.settings.keyboardShortcuts,lineLength:e.settings.lineLength,noteId:e.ui.openedNote,note:e.data.notes.get(e.ui.openedNote),notes:e.data.notes,searchQuery:e.ui.searchQuery,selectedSearchMatchIndex:e.ui.selectedSearchMatchIndex,spellCheckEnabled:e.settings.spellCheckEnabled,theme:$.a(e)}}),ge)(he),ve=n(650);function ye(e){return(ye="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function be(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Se(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function we(e,t){return(we=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ee(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Te(e);if(t){var r=Te(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Ce(this,n)}}function Ce(e,t){return!t||"object"!==ye(t)&&"function"!=typeof t?Oe(e):t}function Oe(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Te(e){return(Te=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ne(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ke=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&we(e,t)}(a,e);var t,n,o,i=Ee(a);function a(){var e;be(this,a);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return Ne(Oe(e=i.call.apply(i,[this].concat(n))),"focusEditor",(function(){return e.focusContentEditor&&e.focusContentEditor()})),Ne(Oe(e),"hasFocus",(function(){var t,n;return null===(t=(n=e).editorHasFocus)||void 0===t?void 0:t.call(n)})),Ne(Oe(e),"storeEditorHasFocus",(function(t){return e.editorHasFocus=t})),Ne(Oe(e),"storeFocusContentEditor",(function(t){return e.focusContentEditor=t})),e}return t=a,(n=[{key:"componentDidMount",value:function(){this.props.storeFocusEditor(this.focusEditor),this.props.storeHasFocus(this.hasFocus)}},{key:"render",value:function(){var e=this.props.openedNote;return r.a.createElement("div",{className:"note-detail-wrapper"},e?r.a.createElement(me,{key:e,storeFocusEditor:this.storeFocusContentEditor,storeHasFocus:this.storeEditorHasFocus}):r.a.createElement("div",{className:"note-detail-placeholder"},r.a.createElement(ve.a,null)))}}])&&Se(t.prototype,n),o&&Se(t,o),a}(o.Component);Ne(ke,"displayName","NoteDetail");var xe=Object(i.b)((function(e){return{isDialogOpen:e.ui.dialogs.length>0,keyboardShortcuts:e.settings.keyboardShortcuts,openedNote:e.ui.openedNote}}))(ke),Ie=n(792);function Fe(e){return(Fe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Me(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function je(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Le(e,t){return(Le=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Re(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Pe(e);if(t){var r=Pe(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Ae(this,n)}}function Ae(e,t){return!t||"object"!==Fe(t)&&"function"!=typeof t?De(e):t}function De(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Pe(e){return(Pe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _e(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Ke=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Le(e,t)}(a,e);var t,n,o,i=Re(a);function a(){var e;Me(this,a);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return _e(De(e=i.call.apply(i,[this].concat(n))),"markdownEnabled",(function(){var t;return null===(t=e.props.note)||void 0===t?void 0:t.systemTags.includes("markdown")})),_e(De(e),"handleShortcut",(function(t){if(e.props.keyboardShortcuts){var n,o,r,i,a=t.ctrlKey,c=t.metaKey,u=t.shiftKey,s=t.key.toLowerCase(),l=e.props,d=l.note,f=l.noteId,p=l.toggleMarkdown,h=a||c;return d&&h&&u&&"m"===s?(p(f,!e.markdownEnabled()),t.stopPropagation(),t.preventDefault(),!1):h&&u&&"p"===s&&e.markdownEnabled()?(e.props.toggleEditMode(),t.stopPropagation(),t.preventDefault(),!1):!(u&&h&&"y"===s&&e.props.isEditorActive)||(!e.editFieldHasFocus()||e.props.isSearchActive?(null===(n=(o=e).focusNoteEditor)||void 0===n||n.call(o),t.stopPropagation(),t.preventDefault(),!1):(null===(r=(i=e).focusTagField)||void 0===r||r.call(i),t.stopPropagation(),t.preventDefault(),!1))}})),_e(De(e),"editFieldHasFocus",(function(){return e.editorHasFocus&&e.editorHasFocus()})),_e(De(e),"storeEditorHasFocus",(function(t){return e.editorHasFocus=t})),_e(De(e),"storeFocusEditor",(function(t){return e.focusNoteEditor=t})),_e(De(e),"storeFocusTagField",(function(t){return e.focusTagField=t})),_e(De(e),"storeTagFieldHasFocus",(function(t){return e.tagFieldHasFocus=t})),_e(De(e),"tagFieldHasFocus",(function(){return e.tagFieldHasFocus&&e.tagFieldHasFocus()})),_e(De(e),"toggleShortcuts",(function(t){t?window.addEventListener("keydown",e.handleShortcut,!0):window.removeEventListener("keydown",e.handleShortcut,!0)})),e}return t=a,(n=[{key:"componentDidMount",value:function(){this.toggleShortcuts(!0)}},{key:"componentWillUnmount",value:function(){this.toggleShortcuts(!1)}},{key:"render",value:function(){var e=this.props,t=e.editMode,n=e.hasSearchQuery,o=e.hasSearchMatchesInNote,i=e.note,a=e.noteId;if(!i)return r.a.createElement("div",{className:"note-detail-placeholder"},r.a.createElement(ve.a,null));var c=!!i.deleted;return r.a.createElement("div",{className:"note-editor theme-color-bg theme-color-fg"},t||!i.systemTags.includes("markdown")?r.a.createElement(xe,{storeFocusEditor:this.storeFocusEditor,storeHasFocus:this.storeEditorHasFocus}):r.a.createElement(Ie.default,{noteId:a}),i&&!c&&r.a.createElement(B,{storeFocusTagField:this.storeFocusTagField,storeHasFocus:this.storeTagFieldHasFocus}),n&&o&&r.a.createElement(s,null))}}])&&je(t.prototype,n),o&&je(t,o),a}(o.Component);_e(Ke,"displayName","NoteEditor");var He={toggleNoteList:Y.a.ui.toggleNoteList,toggleMarkdown:Y.a.data.markdownNote,toggleEditMode:Y.a.ui.toggleEditMode};t.default=Object(i.b)((function(e){return{allTags:e.data.tags,editMode:e.ui.editMode,keyboardShortcuts:e.settings.keyboardShortcuts,isEditorActive:!e.ui.showNavigation,noteId:e.ui.openedNote,note:e.data.notes.get(e.ui.openedNote),revision:e.ui.selectedRevision,hasSearchQuery:""!==e.ui.searchQuery,hasSearchMatchesInNote:!!e.ui.numberOfMatchesInNote&&e.ui.numberOfMatchesInNote>0,isSearchActive:!!e.ui.searchQuery.length,isSmallScreen:$.b(e)}}),He)(Ke)},792:function(e,t,n){"use strict";n.r(t),n.d(t,"NotePreview",(function(){return w}));var o=n(0),r=n.n(o),i=n(487),a=n(549),c=n(787),u=n.n(c),s=n(788),l=n.n(s),d=n(33),f={type:"output",regex:'<input type="checkbox" disabled',replace:'<input type="checkbox" '},p=function(e){return n.e(18).then(n.t.bind(null,1263,7)).then((function(t){var n=t.default;n.extension("enableCheckboxes",f);var o=new n.Converter({extensions:["enableCheckboxes"]});o.setFlavor("github"),o.setOption("simpleLineBreaks",!1),o.setOption("ghMentions",!1),o.setOption("smoothLivePreview",!0),o.setOption("tables",!0),o.setOption("strikethrough",!0);var r=e.replace(/([ \t\u2000-\u200a]*)\u2022(\s)/gm,"$1-$2");return function(e){for(var t=(new DOMParser).parseFromString(e,"text/html"),n=t.createTreeWalker(t.body,NodeFilter.SHOW_ALL,null,!1),o=[],r=[],i=function(){var e=n.currentNode;if(function(e){switch(e.nodeName.toLowerCase()){case"head":case"html":case"iframe":case"link":case"meta":case"object":case"script":case"style":return!0;default:return!1}}(e))return r.push(e),"continue";if(!function(e){var t=e.nodeName.toLowerCase();if("input"===t)return"checkbox"===e.getAttribute("type");switch(t){case"#text":case"a":case"article":case"b":case"br":case"blockquote":case"cite":case"code":case"dd":case"del":case"div":case"dt":case"em":case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":case"hr":case"i":case"img":case"ins":case"kbd":case"li":case"ol":case"p":case"pre":case"s":case"span":case"strong":case"sub":case"sup":case"table":case"tbody":case"td":case"th":case"thead":case"tr":case"tt":case"ul":return!0;default:return!1}}(e))return o.push(e),"continue";var t=e.nodeName.toLowerCase();Object(d.filter)(e.attributes,(function(e){var n=e.name,o=e.value;return!function(e,t,n){switch(e){case"a":switch(t){case"href":return["http","https","simplenote"].includes(n.toLowerCase().trim().split("://")[0]);case"alt":case"rel":case"title":return!0;default:return!1}case"img":switch(t){case"alt":case"src":case"title":case"width":return!0;default:return!1}case"input":switch(t){case"disabled":case"checked":case"type":return!0;default:return!1}case"li":switch(t){case"class":switch(n){case"task-list-item":return!0;default:return!1}default:return!1}case"ol":switch(t){case"start":return!0;default:return!1}case"th":case"td":switch(t){case"style":switch(n){case"text-align:center;":case"text-align:left;":case"text-align:right;":return!0;default:return!1}default:return!1}default:return!1}}(t,n,o)&&(("href"!==n&&"src"!==n||!l.a.isWebUri(o))&&("href"!==n||!o.startsWith("mailto:")||!u.a.validate(o.slice(7))))})).forEach((function(t){var n=t.name;return e.removeAttribute(n)}));var i="a"===t&&e.getAttribute("href");"a"!==t||"string"!=typeof i||i.startsWith("mailto:")||(e.setAttribute("target","_blank"),e.setAttribute("rel","external noopener noreferrer")),"li"===t&&"task-list-item"===e.getAttribute("class")&&e.setAttribute("style","list-style: none;")};n.nextNode();)i();return r.forEach((function(e){try{var t;null==e||null===(t=e.parentNode)||void 0===t||t.removeChild(e)}catch(e){}})),o.forEach((function(e){var t,n=e.parentNode;try{for(;t=e.firstChild;)null==n||n.insertBefore(t,e);null==n||n.removeChild(e)}catch(e){}})),t.body.innerHTML}(o.makeHtml(r))}))},h=function(e,t,o){return p(t).then((function(t){return e.innerHTML=t,e})).then((function(e){if(!o)return e.querySelectorAll("pre code");var t=Object(a.a)(o).map((function(e){return e.toLocaleLowerCase()}));if(!t.length)return e.querySelectorAll("pre code");for(var n=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,{acceptNode:function(e){return t.some((function(t){var n;return null===(n=e.textContent)||void 0===n?void 0:n.toLocaleLowerCase().includes(t)}))?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}},!1),r=[],i=n.currentNode;i;)r.push(i),i=n.nextNode();return r.forEach((function(e){return function e(t,n){var o=t.parentNode;n.forEach((function(t){o.childNodes.forEach((function(o){var r,i,a;if(o.nodeType===Node.TEXT_NODE&&(null===(r=o.textContent)||void 0===r?void 0:r.toLocaleLowerCase().includes(t))){var c=null===(i=o.textContent)||void 0===i?void 0:i.toLocaleLowerCase().indexOf(t),u=o.splitText(c),s=u.splitText(t.length),l=document.createElement("span");l.setAttribute("class","search-match"),null===(a=u.parentNode)||void 0===a||a.replaceChild(l,u),l.appendChild(u),e(s,n)}}))}))}(e,t)})),e.querySelectorAll("pre code")})).then((function(e){if(e.length)return n.e(13).then(n.t.bind(null,1262,7)).then((function(t){var n=t.default;e.forEach(n.highlightBlock)})).catch()}))},g=n(133),m=n(590),v=n(500);function y(e){return(y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function b(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],o=!0,r=!1,i=void 0;try{for(var a,c=e[Symbol.iterator]();!(o=(a=c.next()).done)&&(n.push(a.value),!t||n.length!==t);o=!0);}catch(e){r=!0,i=e}finally{try{o||null==c.return||c.return()}finally{if(r)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return S(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return S(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function S(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}var w=function(e){var t,n=e.editNote,i=e.isFocused,a=e.note,c=e.noteId,u=e.notes,s=e.openNote,l=e.searchQuery,d=e.showRenderedView,f=Object(o.useRef)();return Object(o.useEffect)((function(){var e=function(e){if(!i)return!0;if(!document.getSelection().isCollapsed)return!0;var t=document.createElement("div");h(t,a.content,l).then((function(){try{e.clipboardData.setData("text/plain",t.innerHTML)}catch(e){navigator.clipboard.writeText(t.innerHTML)}})),e.preventDefault()};return document.addEventListener("copy",e,!1),function(){return document.removeEventListener("copy",e,!1)}}),[i,l]),Object(o.useEffect)((function(){var e,t=function(e){for(var t=e.target;null!==t;t=t.parentNode){if("A"===t.tagName){e.preventDefault(),e.stopPropagation();var o=t;if(o.href.startsWith("simplenote://note/")){var r=/^simplenote:\/\/note\/(.+)$/.exec(o.href);if(!r)return;var i=b(r,2),l=(i[0],i[1]);return void(u.has(l)&&s(l))}return void(o.href.startsWith("http://localhost")||Object(g.a)(o.href))}if("task-list-item"===t.className){var d=function(){e.preventDefault(),e.stopPropagation();var o=f.current.querySelectorAll("[data-markdown-root] .task-list-item"),r=Array.prototype.indexOf.call(o,t),i=0,u=a.content.replace(/(- \[x\]|- \[ \])/g,(function(e){return i++===r?"- [ ]"===e?"- [x]":"- [ ]":e}));return n(c,{content:u}),{v:void 0}}();if("object"===y(d))return d.v}}};return null===(e=f.current)||void 0===e||e.addEventListener("click",t,!0),function(){var e;return null===(e=f.current)||void 0===e?void 0:e.removeEventListener("click",t,!0)}}),[a]),Object(o.useEffect)((function(){var e;f.current&&((null==a?void 0:a.content)&&d?h(f.current,a.content,l):f.current.innerText=Object(m.a)(null!==(e=null==a?void 0:a.content)&&void 0!==e?e:""))}),[null==a?void 0:a.content,l,d]),r.a.createElement("div",{className:"note-detail-wrapper"},r.a.createElement("div",{className:"note-detail note-detail-preview"},r.a.createElement("div",{ref:f,className:"note-detail-markdown theme-color-bg theme-color-fg","data-markdown-root":!0},r.a.createElement("div",{style:{whiteSpace:"pre"}},!d&&Object(m.a)(null!==(t=null==a?void 0:a.content)&&void 0!==t?t:"")))))},E={editNote:v.a.data.editNote,openNote:v.a.ui.selectNote};t.default=Object(i.b)((function(e,t){var n,o,r=null!==(n=t.noteId)&&void 0!==n?n:e.ui.openedNote,i=null!==(o=t.note)&&void 0!==o?o:e.data.notes.get(r);return{isFocused:0===e.ui.dialogs.length&&!e.ui.showNoteInfo,note:i,noteId:r,notes:e.data.notes,searchQuery:e.ui.searchQuery,showRenderedView:!!(null==i?void 0:i.systemTags.includes("markdown"))&&!e.ui.editMode}}),E)(w)}}]);